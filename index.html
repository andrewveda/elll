<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Test</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  select, button { margin: 5px 0; padding: 5px; font-size: 16px; }
  #sentenceBox { margin-top: 10px; font-weight: bold; }
  #score { margin-top: 10px; font-size: 18px; font-weight: bold; white-space: pre-line; }
</style>
</head>
<body>

<h2>Department & Register Voice Test</h2>

<label>Department:</label>
<select id="departmentSelect">
  <option value="">Select Department</option>
</select><br>

<label>Register Number:</label>
<select id="regNoSelect">
  <option value="">Select Register Number</option>
</select><br>

<div id="sentenceBox"></div>

<button id="startRec">Start Speaking</button>
<button id="stopRec" disabled>Stop</button>

<div id="score"></div>

<script>
// Hardcoded data
const data = [
  {department: "Cyber Security", regNo: "CS101", sentence: "Grit gathers glory, grows greatness and makes grand the game of life"},
  {department: "Cyber Security", regNo: "CS102", sentence: "Be yourself everyone else is already taken"},
  {department: "Mechanical", regNo: "ME101", sentence: "Engineering minds build bridges and shape the world"},
  {department: "Mechanical", regNo: "ME102", sentence: "Innovation comes from persistence and curiosity"}
];

const departmentSelect = document.getElementById('departmentSelect');
const regNoSelect = document.getElementById('regNoSelect');
const sentenceBox = document.getElementById('sentenceBox');
const scoreBox = document.getElementById('score');

let currentSentence = "";
let recognition;

// Populate department dropdown
[...new Set(data.map(d=>d.department))].forEach(dep=>{
  const option = document.createElement('option');
  option.value = dep;
  option.textContent = dep;
  departmentSelect.appendChild(option);
});

// Populate regNo dropdown based on department
departmentSelect.addEventListener('change', ()=>{
  const selectedDept = departmentSelect.value;
  regNoSelect.innerHTML = '<option value="">Select Register Number</option>';
  data.filter(d=>d.department===selectedDept).forEach(r=>{
    const option = document.createElement('option');
    option.value = r.regNo;
    option.textContent = r.regNo;
    regNoSelect.appendChild(option);
  });
  currentSentence = "";
  sentenceBox.textContent = "";
  scoreBox.textContent = "";
});

regNoSelect.addEventListener('change', ()=>{
  const selectedReg = regNoSelect.value;
  const entry = data.find(d=>d.regNo===selectedReg);
  if(entry){
    currentSentence = entry.sentence;
    sentenceBox.textContent = currentSentence;
  } else {
    currentSentence = "";
    sentenceBox.textContent = "";
  }
});

// Setup Web Speech API
function startRecognition(){
  if(!currentSentence){
    alert("Select a department and register number first!");
    return;
  }
  recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  recognition.continuous = false;

  recognition.onresult = (event)=>{
    const transcript = event.results[0][0].transcript;
    const distance = levenshteinDistance(transcript.toLowerCase(), currentSentence.toLowerCase());
    const feedback = distance === 0 ? "Correct ✅" : "Wrong ❌";
    scoreBox.textContent = `You said: "${transcript}"\nLevenshtein Distance: ${distance}\n${feedback}`;
  };

  recognition.onerror = (event)=>{
    alert("Error: "+event.error);
  };

  recognition.onend = ()=>{
    document.getElementById('startRec').disabled = false;
    document.getElementById('stopRec').disabled = true;
  };

  recognition.start();
  document.getElementById('startRec').disabled = true;
  document.getElementById('stopRec').disabled = false;
}

document.getElementById('startRec').addEventListener('click', startRecognition);

document.getElementById('stopRec').addEventListener('click', ()=>{
  if(recognition) recognition.stop();
});
  
// Levenshtein distance
function levenshteinDistance(a,b){
  const dp = Array(a.length+1).fill().map(()=>Array(b.length+1).fill(0));
  for(let i=0;i<=a.length;i++) dp[i][0]=i;
  for(let j=0;j<=b.length;j++) dp[0][j]=j;
  for(let i=1;i<=a.length;i++){
    for(let j=1;j<=b.length;j++){
      if(a[i-1]===b[j-1]) dp[i][j]=dp[i-1][j-1];
      else dp[i][j]=1+Math.min(dp[i-1][j],dp[i][j-1],dp[i-1][j-1]);
    }
  }
  return dp[a.length][b.length];
}
</script>

</body>
</html>
