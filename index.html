<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice Quest Recorder</title>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
}
label, select, button {
    margin: 5px 0;
    display: block;
}
#sentenceBox {
    margin: 10px 0;
    padding: 10px;
    border: 1px solid #ccc;
    background-color: #f9f9f9;
}
button {
    padding: 8px 15px;
    cursor: pointer;
}
</style>
</head>
<body>

<h2>Voice Quest Recorder</h2>

<label for="department">Department:</label>
<select id="department">
  <option value="">Select Department</option>
  <option value="CSE">CSE</option>
  <option value="ECE">ECE</option>
</select>

<label for="regno">Register Number:</label>
<select id="regno">
  <option value="">Select Register No</option>
  <option value="101">101</option>
  <option value="102">102</option>
</select>

<button id="loadSentence">Load Sentence</button>

<div id="sentenceBox">Your sentence will appear here.</div>

<button id="recordBtn">Start/Stop Recording</button>
<audio id="playAudio" controls></audio>

<script>
/* ================= CONFIGURATION ================= */
const SHEET_ID = '1jHT-VU_4Wx6-_o-bnlyFv-NgLB1LukFee9RZvsdiqxs'; // <-- Replace with your Google Sheet ID
const SHEET_NAME = 'Sheet1';
const API_KEY = 'YOUR_API_KEY';   // <-- Replace with your Google Sheets API Key

/* ================ FETCH GOOGLE SHEET DATA ================ */
async function fetchSheetData() {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${1jHT-VU_4Wx6-_o-bnlyFv-NgLB1LukFee9RZvsdiqxs}/values/${Sheet1}?key=${API_KEY}`;
    const res = await fetch(url);
    const data = await res.json();
    
    if (!data.values) return [];

    const [header, ...rows] = data.values;
    return rows.map(row => {
        let obj = {};
        header.forEach((col, i) => obj[col] = row[i] || '');
        return obj;
    });
}

/* ================ LOAD SENTENCE BASED ON SELECTION ================ */
document.getElementById('loadSentence').addEventListener('click', async () => {
    const dept = document.getElementById('department').value;
    const regNo = document.getElementById('regno').value;

    if (!dept || !regNo) return alert('Please select both Department and Register Number');

    const sheetData = await fetchSheetData();
    const record = sheetData.find(r => r.Department === dept && r.RegisterNo === regNo);

    if (record) {
        document.getElementById('sentenceBox').innerText = record.Sentence || 'No sentence found';

        // If MP3 exists in sheet
        if (record.MP3File) {
            const audio = document.getElementById('playAudio');
            audio.src = record.MP3File;
            audio.load();
        } else {
            document.getElementById('playAudio').src = '';
        }
    } else {
        alert('No sentence found for this selection.');
        document.getElementById('sentenceBox').innerText = '';
        document.getElementById('playAudio').src = '';
    }
});

/* ================ VOICE RECORDING ================ */
let mediaRecorder;
let audioChunks = [];

document.getElementById('recordBtn').addEventListener('click', async () => {
    if (!mediaRecorder) {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            const audioUrl = URL.createObjectURL(audioBlob);
            document.getElementById('playAudio').src = audioUrl;
            audioChunks = [];
        };
    }

    if (mediaRecorder.state === 'inactive') {
        mediaRecorder.start();
        alert('Recording started...');
    } else {
        mediaRecorder.stop();
        alert('Recording stopped.');
    }
});
</script>

</body>
</html>
